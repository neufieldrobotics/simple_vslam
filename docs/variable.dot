digraph structs {
    graph [fontsize=10 fontname="Verdana" compound=true];
    node [shape=record fontsize=10 fontname="Verdana"];
    rankdir = LR
    subgraph cluster_0 
    {
    node [style=filled];
    label = "FRAME i";
    color=blue;
    
    
    subgraph cluster_0_l
    {
    label = keypoints
    color=black; 
    fr_i_l[label="{ { <M2_i> kp_m_prev_lm_ind|<M1_i>kp_m_prev_cand_ind|<UM_i>kp_unmatched }}" fillcolor = yellow pos = "0,0"]
    }
    subgraph cluster_0_r
       { 
       color=black;
       label = "keypoints and landmarks";
       fr_i_r[label="{{ <kp_lm_ind>kp_lm_ind | <kp_cand_ind>kp_cand_ind}}", shape = "Mrecord" fillcolor=green];
       lm_i[label="lm_ind" shape=triangle fillcolor=green]
       }
        
       pose_est_i[shape = circle label="T_i" fillcolor=lightblue]
       fr_i_l:M1_i->fr_i_r:kp_lm_ind
       fr_i_l:M2_i->fr_i_r:kp_lm_ind
       fr_i_l:UM_i->fr_i_r:kp_cand_ind 
    }

    subgraph cluster_1 {
        node [style=filled];
        label = "FRAME j";
        color=blue;
    subgraph cluster_1_l
    {
    label = keypoints
        fr_j_l [label="{ {<M2_j> kp_m_prev_lm_ind|<M1_j>kp_m_prev_cand_ind |<UM_j>kp_unmatched }}" fillcolor = yellow ]
       } 
      subgraph cluster_1_r
       { 
       color=black;
       label = "keypoints and landmarks"; 
        fr_j_r[label="{{ <kp_lm_ind>kp_lm_ind | <kp_cand_ind>kp_cand_ind}}" shape = "Mrecord" fillcolor=green];
        lm_j[label="lm_ind" shape = triangle fillcolor = green]
 }      
       lm_j_new[label="new lm" shape = triangle fillcolor = yellow] 
       pose_est_j[shape = circle label="T_j PNP" fillcolor = lightblue]
       fr_j_l:M1_j->fr_j_r:kp_lm_ind
       fr_j_l:M2_j->fr_j_r:kp_lm_ind
       fr_j_l:UM_j->fr_j_r:kp_cand_ind
} 
    
    fr_i_r:kp_lm_ind->fr_j_l:M2_j[label="1. match and PNP" dir="both"];
    //PNP:"e"->fr_i_r:kp_lm_ind:"e"
    //PNP->fr_j_l:M2_j
    fr_i_r:kp_cand_ind->fr_j_l:M1_j[label="2. match and Triangulate" dir = "both"];
    lm_i->lm_j
    lm_j_new->lm_j
 }
